// Tue Jan 13 2026 - Alex

use crate::pattern::Pattern;
use std::collections::HashMap;

pub struct LuaApiPatterns {
    patterns: HashMap<String, Pattern>,
}

impl LuaApiPatterns {
    pub fn new() -> Self {
        let mut patterns = HashMap::new();

        patterns.insert("lua_newstate".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? 52 ?? ?? ?? 94"
        ).with_name("lua_newstate"));

        patterns.insert("lua_close".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? F9 ?? ?? ?? 94"
        ).with_name("lua_close"));

        patterns.insert("lua_newthread".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? ?? 94 ?? ?? ?? F9"
        ).with_name("lua_newthread"));

        patterns.insert("lua_gettop".to_string(), Pattern::from_hex(
            "F9 ?? ?? ?? F9 ?? ?? ?? CB ?? ?? ?? D1 ?? ?? ?? 93 C0 03 5F D6"
        ).with_name("lua_gettop"));

        patterns.insert("lua_settop".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 37"
        ).with_name("lua_settop"));

        patterns.insert("lua_pushvalue".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? A9"
        ).with_name("lua_pushvalue"));

        patterns.insert("lua_remove".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? F9"
        ).with_name("lua_remove"));

        patterns.insert("lua_insert".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? 94"
        ).with_name("lua_insert"));

        patterns.insert("lua_replace".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 94"
        ).with_name("lua_replace"));

        patterns.insert("lua_type".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 34 ?? ?? ?? 39"
        ).with_name("lua_type"));

        patterns.insert("lua_typename".to_string(), Pattern::from_hex(
            "?? ?? ?? 90 ?? ?? ?? 91 ?? ?? ?? 8B ?? ?? ?? F9 C0 03 5F D6"
        ).with_name("lua_typename"));

        patterns.insert("lua_tonumber".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 34 ?? ?? ?? 1E"
        ).with_name("lua_tonumber"));

        patterns.insert("lua_toboolean".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 34 ?? ?? ?? F9"
        ).with_name("lua_toboolean"));

        patterns.insert("lua_tolstring".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? 94"
        ).with_name("lua_tolstring"));

        patterns.insert("lua_objlen".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_objlen"));

        patterns.insert("lua_touserdata".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 34 ?? ?? ?? 39"
        ).with_name("lua_touserdata"));

        patterns.insert("lua_tothread".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 34 ?? ?? ?? 39"
        ).with_name("lua_tothread"));

        patterns.insert("lua_topointer".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 39 71 ?? ?? 71"
        ).with_name("lua_topointer"));

        patterns.insert("lua_pushnil".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 52 ?? ?? ?? B9"
        ).with_name("lua_pushnil"));

        patterns.insert("lua_pushnumber".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 1E ?? ?? ?? FD"
        ).with_name("lua_pushnumber"));

        patterns.insert("lua_pushinteger".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 9E ?? ?? ?? FD"
        ).with_name("lua_pushinteger"));

        patterns.insert("lua_pushstring".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? B4 ?? ?? ?? 94 ?? ?? ?? F9"
        ).with_name("lua_pushstring"));

        patterns.insert("lua_pushlstring".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? F9"
        ).with_name("lua_pushlstring"));

        patterns.insert("lua_pushboolean".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 52 ?? ?? ?? 72 ?? ?? ?? B9"
        ).with_name("lua_pushboolean"));

        patterns.insert("lua_pushlightuserdata".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 52 ?? ?? ?? F9 ?? ?? ?? B9"
        ).with_name("lua_pushlightuserdata"));

        patterns.insert("lua_pushthread".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? F9 ?? ?? ?? 52 ?? ?? ?? F9"
        ).with_name("lua_pushthread"));

        patterns.insert("lua_gettable".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 94"
        ).with_name("lua_gettable"));

        patterns.insert("lua_getfield".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? 94"
        ).with_name("lua_getfield"));

        patterns.insert("lua_rawget".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_rawget"));

        patterns.insert("lua_rawgeti".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? B9"
        ).with_name("lua_rawgeti"));

        patterns.insert("lua_createtable".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 2A ?? ?? ?? 94"
        ).with_name("lua_createtable"));

        patterns.insert("lua_newuserdata".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? F9"
        ).with_name("lua_newuserdata"));

        patterns.insert("lua_getmetatable".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 39 71 ?? ?? 71"
        ).with_name("lua_getmetatable"));

        patterns.insert("lua_getfenv".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 ?? ?? ?? 39 71 ?? ?? 54"
        ).with_name("lua_getfenv"));

        patterns.insert("lua_settable".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 94"
        ).with_name("lua_settable"));

        patterns.insert("lua_setfield".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? B9"
        ).with_name("lua_setfield"));

        patterns.insert("lua_rawset".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? B9"
        ).with_name("lua_rawset"));

        patterns.insert("lua_rawseti".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 94"
        ).with_name("lua_rawseti"));

        patterns.insert("lua_setmetatable".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_setmetatable"));

        patterns.insert("lua_setfenv".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_setfenv"));

        patterns.insert("lua_call".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 52"
        ).with_name("lua_call"));

        patterns.insert("lua_pcall".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? B9"
        ).with_name("lua_pcall"));

        patterns.insert("lua_cpcall".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 F7 ?? ?? A9"
        ).with_name("lua_cpcall"));

        patterns.insert("lua_yield".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 52"
        ).with_name("lua_yield"));

        patterns.insert("lua_resume".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? F9"
        ).with_name("lua_resume"));

        patterns.insert("lua_status".to_string(), Pattern::from_hex(
            "?? ?? ?? 39 C0 03 5F D6"
        ).with_name("lua_status"));

        patterns.insert("lua_gc".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 F7 ?? ?? A9"
        ).with_name("lua_gc"));

        patterns.insert("lua_error".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 ?? ?? ?? 94 00 00 00 D4"
        ).with_name("lua_error"));

        patterns.insert("lua_next".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_next"));

        patterns.insert("lua_concat".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? B9 ?? ?? ?? 71"
        ).with_name("lua_concat"));

        patterns.insert("lua_pushcclosure".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 F5 ?? ?? A9 ?? ?? ?? 52"
        ).with_name("lua_pushcclosure"));

        patterns.insert("lua_getupvalue".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? 39"
        ).with_name("lua_getupvalue"));

        patterns.insert("lua_setupvalue".to_string(), Pattern::from_hex(
            "FD 7B ?? A9 FD ?? ?? 91 F3 ?? ?? A9 ?? ?? ?? 94 ?? ?? ?? B9"
        ).with_name("lua_setupvalue"));

        Self { patterns }
    }

    pub fn get(&self, name: &str) -> Option<&Pattern> {
        self.patterns.get(name)
    }

    pub fn iter(&self) -> impl Iterator<Item = (&String, &Pattern)> {
        self.patterns.iter()
    }

    pub fn len(&self) -> usize {
        self.patterns.len()
    }

    pub fn is_empty(&self) -> bool {
        self.patterns.is_empty()
    }

    pub fn names(&self) -> Vec<&String> {
        self.patterns.keys().collect()
    }
}

impl Default for LuaApiPatterns {
    fn default() -> Self {
        Self::new()
    }
}
